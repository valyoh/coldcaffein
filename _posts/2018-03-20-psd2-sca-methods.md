---
layout: post
title: PSD2 според Берлинската група
tags: [PSD2, SCA]
---

[PSD2](https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en){:target="blank"} е директива на Европейският съюз, която изисква от банките да отворят достъпа до платежната си инфраструктура и до данни за клиентите си за трети лица наречени TPP (Third Party Providers), които от своя страна да разработват платежни и информационни услуги за своите клиенти. Поради тази причина PSD2 е не само регулаторна рамка и технологично предизвикателство, но и стратегическо.

[PSD2](https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en){:target="blank"} дефинира три вида TPP доставчици, а именно:

* AISP (Account Information Service Provider)<br>
AISP играе ролята на агрегатор на данни свързани със сметките на PSU (Payment Service User) от една или много различни банки. В терминологията на [PSD2](https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en){:target="blank"} банковите институции са наречени ASPSP (Account Serviceing Payment Service Provider).<br>

* PISP (Payment Initiation Service Providers)<br>
Този вид доставчици могат да комуникират с банката на клиента по сигурен канал и да достъпват информация необходима за извършване на транзакции, както и да извършват транзакции от името на клиента, след като клиента им е дал своето разрешение.<br>

* PIISP (Payment Instruments Issuing Service Provider)<br> 
Това е доставчик, които дава информация за наличност по сметка, като не дава информация за баланс, а връща прост отговор да/не.<br>

Интерфейса, които банките трябва да предоставят е под формата на REST API, но директивата не специфицира как трябва да изглежда той. Като част от [PSD2](https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en){:target="blank"}, EBA (European Banking Authority) е задължена да формулира регулаторен технически стандарт RTS (Regulatory Technical Standards) за силна клиентска автентикация SCA (Strong Customer Authentication) и унифицирана сигурна комуникация CSC (Common and Secure Communication).

EBA предлага само фреймуърк посочващ общи условия и даващ насоки за имплементация на XS2A (Access to Accounts) интерфес, в резултат на което все още няма стандарт за имплементация на [PSD2](https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en){:target="blank"} възприет от европейските банки. 
[Берлинската група](https://www.berlin-group.org/psd2-access-to-bank-accounts){:target="blank"}, която се състои от повече от 40 банки, асоциации и платежни оператори, се опитва да запълни тази празнина, като се дефинира общ API стандарт за цяла Европа, наречен "NextGenPSD2". Подобни инициативи има стартирани в Полша, Словения и Франция, но стандарта на Берлинската група е един от най-пълните.

В наръчника за имплементация за [PSD2](https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en){:target="blank"} на Берлинската група широко се дискутира SCA. Представени са три различни подхода за имплементиране на SCA процедурата и са обсъдени разликите между тях. Но кои е най-подходящият подход за вашата организация? Нека са опитам да синтезирам информацията представена в "NextGenPSD2" отнасяща се за SCA процедурата.  

## Подход с пренасочване (Redirection)

Този подход използва предефиниран адрес за пренасочване по време на автентикация, които пренасочва потребителят на определен уеб интерфейс, където се извършва SCA процедурата между PSU и ASPSP.

Хубавото на този подход е че TPP няма нужда от никаква детайлна информация за индивидуалният PSU. Поради тази причина подходът с пренасочване е лесен за имплементация за TPP. По долу е показана диаграма с последователността при обмена на съобщения.<br>
![Redirect]({{ site.baseurl }}/assets/img/psd2/PSD2-SCA-Redirect.png)

Берлинската група дефинира и един "четвърти" подход наречен OAuth2, които по същество не се отличава от подхода с пренасочване. Просто е специфицирано, че взаимодействието между PSU и ASPS се извършва по протокол OAuth2. Това е сивият правоъгълник в диаграмата.

## Подход с отделяне (Decoupled)
Подходът с отделяне е много подобен на този с пренасочване, като основната разлика е, че ASPSP иска (инициира) от потребителят PSU да се автентикира. Това може да бъде извършено например чрез мобилно приложение или друго приложение/устройство, което е независимо (отделено) от техният онлайн банкинг фронт-енд. ASPSP изисква от TPP да информира PSU за изискваната автентикация като му дава съобщение от вида "Моля използвайте приложение XXX, за да оторизирате това плащане". 
След като бъде извършена SCA процедурата между ASPSP и PSU, провайдерът TPP пита за резултатът от транзакцията.<br>

![Redirect]({{ site.baseurl }}/assets/img/psd2/PSD2-SCA-Decoupled.png)

Също както при подхода с пренасочване този SCA метод позволява да се избегне имплементация на каквато и да е SCA процедура в интерфейса на TPP приложените, което е и целта. Целият SCA процес се извършва между PSU и ASPSP.

## Подход с вграждане (Embedded)

Подходът с вграждане изисква повече от TPP в техният интерфейс относно PSU. Тъй като е необходимо да се знае как да бъде обработена и представена информацията по подходящ начин. Подходът с вграждане също може да включва предизвикателства като изчисляване на OTP и след това TPP трябва да знае как да представи тази информация.
За ASPSP този SCA подход предоставя голям набор от възможности за автентикация, тъй като челинджа може да бъде базиран на различни методи, например - снимка, пръстов отпечатък, изображени за разчитане и други.<br>
![Redirect]({{ site.baseurl }}/assets/img/psd2/PSD2-SCA-Embedded.png)

Ако имате нужда от консултация за PSD2 API имплементация може, да отправите запитване към [IBS](http://www.ibs.bg){:target="blank"} 

P.S. SCA процедурата според RTS трябва да бъде поне двуфакторна, като процедурата се извършва по независими комуникационни канали (например преносната мрежа на мобилен оператор и интернет). За целта са дефинирани няколко, класа от данни, които могат да бъдат използвани за извършване на SCA, но най-често използваните подходи са OTP (One Тime Password) или пък се използва баркод. Всъщност за SCA процедурата има доста повече детайли, като кога трябва да бъде прилагана и кога не, какво трябва да бъде ембеднато като информация в челинжда и други, но в този пост няма да навлизам в повече детайли.